{"version":3,"file":"background.js","sources":["src/menu/dev_menu_template.js","src/menu/edit_menu_template.js","src/helpers/window.js","src/env.js","src/background.js"],"sourcesContent":["import { app, BrowserWindow } from 'electron';\r\nimport jetpack from 'fs-jetpack';\r\n\r\nexport var devMenuTemplate = {\r\n    label: 'Development',\r\n    submenu: [{\r\n        label: 'Reload',\r\n        accelerator: 'CmdOrCtrl+R',\r\n        click: function () {\r\n            BrowserWindow.getFocusedWindow().webContents.reloadIgnoringCache();\r\n        }\r\n    },{\r\n        label: 'Toggle DevTools',\r\n        accelerator: 'Alt+CmdOrCtrl+I',\r\n        click: function () {\r\n            BrowserWindow.getFocusedWindow().toggleDevTools();\r\n        }\r\n    },{\r\n        label: 'Quit',\r\n        accelerator: 'CmdOrCtrl+Q',\r\n        click: function () {\r\n            app.quit();\r\n        }\r\n    },{\r\n        label: 'Clear preferences',\r\n        accelerator: 'CmdOrCtrl+D',\r\n        click: function () {\r\n            var slash = (function() {\r\n                if(process.platform === 'darwin' || process.platform === 'linux') {\r\n                    return '/';\r\n                }\r\n                else return '\\\\'\r\n            })();\r\n            var path = app.getPath('userData');\r\n            path = path + slash + 'vizzyPrefs.json';\r\n            jetpack.remove(path);\r\n        }\r\n    }]\r\n};\r\n","export var editMenuTemplate = {\r\n    label: 'Edit',\r\n    submenu: [\r\n        { label: \"Undo\", accelerator: \"CmdOrCtrl+Z\", selector: \"undo:\" },\r\n        { label: \"Redo\", accelerator: \"Shift+CmdOrCtrl+Z\", selector: \"redo:\" },\r\n        { type: \"separator\" },\r\n        { label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\r\n        { label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\r\n        { label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\r\n        { label: \"Select All\", accelerator: \"CmdOrCtrl+A\", selector: \"selectAll:\" }\r\n    ]\r\n};\r\n","// This helper remembers the size and position of your windows (and restores\r\n// them in that place after app relaunch).\r\n// Can be used for more than one window, just construct many\r\n// instances of it and give each different name.\r\n\r\nimport { app, BrowserWindow, screen } from 'electron';\r\nimport jetpack from 'fs-jetpack';\r\n\r\nexport default function (name, options) {\r\n\r\n    var userDataDir = jetpack.cwd(app.getPath('userData'));\r\n    var stateStoreFile = 'window-state-' + name +'.json';\r\n    var defaultSize = {\r\n        width: options.width,\r\n        height: options.height\r\n    };\r\n    var state = {};\r\n    var win;\r\n\r\n    var restore = function () {\r\n        var restoredState = {};\r\n        try {\r\n            restoredState = userDataDir.read(stateStoreFile, 'json');\r\n        } catch (err) {\r\n            // For some reason json can't be read (might be corrupted).\r\n            // No worries, we have defaults.\r\n        }\r\n        return Object.assign({}, defaultSize, restoredState);\r\n    };\r\n\r\n    var getCurrentPosition = function () {\r\n        var position = win.getPosition();\r\n        var size = win.getSize();\r\n        return {\r\n            x: position[0],\r\n            y: position[1],\r\n            width: size[0],\r\n            height: size[1]\r\n        };\r\n    };\r\n\r\n    var windowWithinBounds = function (windowState, bounds) {\r\n        return windowState.x >= bounds.x &&\r\n            windowState.y >= bounds.y &&\r\n            windowState.x + windowState.width <= bounds.x + bounds.width &&\r\n            windowState.y + windowState.height <= bounds.y + bounds.height;\r\n    };\r\n\r\n    var resetToDefaults = function (windowState) {\r\n        var bounds = screen.getPrimaryDisplay().bounds;\r\n        return Object.assign({}, defaultSize, {\r\n            x: (bounds.width - defaultSize.width) / 2,\r\n            y: (bounds.height - defaultSize.height) / 2\r\n        });\r\n    };\r\n\r\n    var ensureVisibleOnSomeDisplay = function (windowState) {\r\n        var visible = screen.getAllDisplays().some(function (display) {\r\n            return windowWithinBounds(windowState, display.bounds);\r\n        });\r\n        if (!visible) {\r\n            // Window is partially or fully not visible now.\r\n            // Reset it to safe defaults.\r\n            return resetToDefaults(windowState);\r\n        }\r\n        return windowState;\r\n    };\r\n\r\n    var saveState = function () {\r\n        if (!win.isMinimized() && !win.isMaximized()) {\r\n            Object.assign(state, getCurrentPosition());\r\n        }\r\n        userDataDir.write(stateStoreFile, state, { atomic: true });\r\n    };\r\n\r\n    state = ensureVisibleOnSomeDisplay(restore());\r\n\r\n    win = new BrowserWindow(Object.assign({}, options, state));\r\n\r\n    win.on('close', saveState);\r\n\r\n    return win;\r\n}\r\n","// Simple wrapper exposing environment variables to rest of the code.\r\n\r\nimport jetpack from 'fs-jetpack';\r\n\r\n// The variables have been written to `env.json` by the build process.\r\nvar env = jetpack.cwd(__dirname).read('env.json', 'json');\r\n\r\nexport default env;\r\n","// This is main process of Electron, started as first thing when your\r\n// app starts. This script is running through entire life of your application.\r\n// It doesn't have any windows which you can see on screen, but we can open\r\n// window from here.\r\n\r\nimport path from 'path';\r\nimport url from 'url';\r\nimport { app, Menu } from 'electron';\r\nimport { devMenuTemplate } from './menu/dev_menu_template';\r\nimport { editMenuTemplate } from './menu/edit_menu_template';\r\nimport createWindow from './helpers/window';\r\n\r\n// Special module holding environment variables which you declared\r\n// in config/env_xxx.json file.\r\nimport env from './env';\r\n\r\nvar mainWindow;\r\n\r\nvar setApplicationMenu = function () {\r\n    var menus = [editMenuTemplate];\r\n    if (env.name !== 'production') {\r\n        menus.push(devMenuTemplate);\r\n    }\r\n    Menu.setApplicationMenu(Menu.buildFromTemplate(menus));\r\n};\r\n\r\n// Save userData in separate folders for each environment.\r\n// Thanks to this you can use production and development versions of the app\r\n// on same machine like those are two separate apps.\r\nif (env.name !== 'production') {\r\n    var userDataPath = app.getPath('userData');\r\n    app.setPath('userData', userDataPath + ' (' + env.name + ')');\r\n}\r\n\r\napp.on('ready', function () {\r\n    setApplicationMenu();\r\n\r\n    var mainWindow = createWindow('main', {\r\n        width: 1000,\r\n        height: 600\r\n    });\r\n\r\n    mainWindow.loadURL(url.format({\r\n        pathname: path.join(__dirname, 'app.html'),\r\n        protocol: 'file:',\r\n        slashes: true\r\n    }));\r\n\r\n    if (env.name === 'development') {\r\n        mainWindow.openDevTools();\r\n    }\r\n});\r\n\r\napp.on('window-all-closed', function () {\r\n    app.quit();\r\n});\r\n"],"names":["BrowserWindow","app","path","screen","Menu"],"mappings":"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"}